<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Tracker - Movies, Anime & Series</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Appwrite SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
        }
        .card-hover:active {
            transform: translateY(-2px);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mobile-card-height {
                height: 280px;
            }
            .mobile-compact-text {
                font-size: 0.75rem;
            }
            .mobile-title {
                font-size: 0.9rem;
            }
            .mobile-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
            .mobile-header {
                font-size: 1.75rem;
            }
            .mobile-nav-scroll {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .mobile-filter-stack {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            .mobile-search-dropdown {
                max-height: 60vh;
                overflow-y: auto;
            }
            .mobile-pagination-compact {
                gap: 0.25rem;
            }
            .mobile-pagination-compact button {
                min-width: 2.5rem;
                padding: 0.5rem;
                font-size: 0.875rem;
            }
        }
        
        /* Improve touch targets */
        button, a, input, select {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        /* Better mobile scrolling */
        * {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Hide suggestion dropdown on small screens when keyboard is open */
        @media (max-height: 500px) {
            .mobile-search-dropdown {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // TMDB API
        const TMDB_API_KEY = '9427a28ea4bc42a44ee6bf3d3d6a746b';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
        
        // Jikan API (MyAnimeList)
        const JIKAN_BASE_URL = 'https://api.jikan.moe/v4';

        // Authentication
        const AUTH_USER = 'Yonik';
        const AUTH_PASS = 'nikyo@2121';

        // ‚ö†Ô∏è IMPORTANT: Replace these with your Appwrite configuration
        const APPWRITE_ENDPOINT = 'https://cloud.appwrite.io/v1';
        const APPWRITE_PROJECT_ID = '691d65c900163de637dc';
        const APPWRITE_DATABASE_ID = '691d8a790022dc7f37e7';
        const APPWRITE_COLLECTION_ID = 'Media';

        // Initialize Appwrite
        const client = new Appwrite.Client()
            .setEndpoint(APPWRITE_ENDPOINT)
            .setProject(APPWRITE_PROJECT_ID);

        const databases = new Appwrite.Databases(client);
        const account = new Appwrite.Account(client);

        function LoginScreen({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (username === AUTH_USER && password === AUTH_PASS) {
                    setLoading(true);
                    try {
                        // Try to login with email session
                        try {
                            await account.createEmailPasswordSession('yonik@mediatracker.com', 'YonikSecure@2121');
                            console.log('Logged in with existing account');
                        } catch (loginError) {
                            console.log('No existing account, creating new one');
                            // If login fails, create a new account
                            try {
                                await account.create('yonik_user_id', 'yonik@mediatracker.com', 'YonikSecure@2121', 'Yonik');
                                // Now login with the new account
                                await account.createEmailPasswordSession('yonik@mediatracker.com', 'YonikSecure@2121');
                                console.log('Created and logged in with new account');
                            } catch (createError) {
                                console.error('Account creation error:', createError);
                                // If account exists but wrong password, try to login again
                                await account.createEmailPasswordSession('yonik@mediatracker.com', 'YonikSecure@2121');
                            }
                        }
                        onLogin();
                    } catch (err) {
                        console.error('Appwrite session error:', err);
                        setError('Could not connect to cloud storage. Please check your internet connection.');
                        setLoading(false);
                        return;
                    }
                    setLoading(false);
                } else {
                    setError('Invalid username or password');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-md">
                        <div className="text-center mb-6 sm:mb-8">
                            <h1 className="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">üé¨ Media Tracker</h1>
                            <p className="text-sm sm:text-base text-gray-600">Please login to continue</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">Username</label>
                                <input
                                    type="text"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                    placeholder="Enter username"
                                    required
                                    disabled={loading}
                                />
                            </div>
                            <div>
                                <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                    placeholder="Enter password"
                                    required
                                    disabled={loading}
                                />
                            </div>
                            {error && (
                                <div className="bg-red-100 border border-red-400 text-red-700 px-3 sm:px-4 py-2 sm:py-3 rounded text-sm sm:text-base">
                                    {error}
                                </div>
                            )}
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white font-bold py-2 sm:py-3 rounded-lg transition text-sm sm:text-base disabled:opacity-50"
                            >
                                {loading ? 'Logging in...' : 'Login'}
                            </button>
                        </form>
                        
                        {APPWRITE_ENDPOINT === 'YOUR_APPWRITE_ENDPOINT' && (
                            <div className="mt-4 p-3 bg-yellow-100 border border-yellow-400 rounded text-xs">
                                ‚ö†Ô∏è Appwrite not configured. Data will only save in browser localStorage.
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function MediaTracker() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [activeTab, setActiveTab] = useState('discover');
            const [mediaType, setMediaType] = useState('all');
            const [genre, setGenre] = useState('all');
            const [content, setContent] = useState([]);
            const [allContent, setAllContent] = useState([]);
            const [loading, setLoading] = useState(false);
            const [watchlist, setWatchlist] = useState([]);
            const [watching, setWatching] = useState([]);
            const [watched, setWatched] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchSuggestions, setSearchSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [currentPage, setCurrentPage] = useState(1);
            const [totalPages, setTotalPages] = useState(1);
            const [saveStatus, setSaveStatus] = useState('');
            const [appwriteDocId, setAppwriteDocId] = useState(null);
            const [selectedItem, setSelectedItem] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [modalDetails, setModalDetails] = useState(null);
            const searchTimeout = useRef(null);
            const ITEMS_PER_PAGE = 20;
            const USER_DOC_ID = 'yonik_data'; // Fixed document ID for this user
            
            // Genre mappings for TMDB
            const GENRE_MAP = {
                '28': 'Action', '12': 'Adventure', '16': 'Animation', '35': 'Comedy',
                '80': 'Crime', '99': 'Documentary', '18': 'Drama', '10751': 'Family',
                '14': 'Fantasy', '36': 'History', '27': 'Horror', '10402': 'Music',
                '9648': 'Mystery', '10749': 'Romance', '878': 'Sci-Fi', '10770': 'TV Movie',
                '53': 'Thriller', '10752': 'War', '37': 'Western'
            };

            // Check if user is logged in
            useEffect(() => {
                const loggedIn = localStorage.getItem('isLoggedIn');
                if (loggedIn === 'true') {
                    setIsAuthenticated(true);
                }
            }, []);

            const handleLogin = () => {
                localStorage.setItem('isLoggedIn', 'true');
                setIsAuthenticated(true);
            };

            const handleLogout = async () => {
                try {
                    await account.deleteSession('current');
                } catch (err) {
                    console.log('No active session to delete');
                }
                localStorage.setItem('isLoggedIn', 'false');
                setIsAuthenticated(false);
            };

            // Load data from Appwrite on authentication
            useEffect(() => {
                if (!isAuthenticated) return;
                loadDataFromAppwrite();
            }, [isAuthenticated]);

            const loadDataFromAppwrite = async () => {
                try {
                    console.log('Attempting to load from Appwrite...');
                    // Try to get existing document
                    const doc = await databases.getDocument(
                        APPWRITE_DATABASE_ID,
                        APPWRITE_COLLECTION_ID,
                        USER_DOC_ID
                    );
                    
                    console.log('Loaded document from Appwrite:', doc);
                    setAppwriteDocId(USER_DOC_ID); // Set to the custom ID we're using
                    
                    // Parse and load data from Appwrite
                    const loadedWatchlist = doc.watchlist ? JSON.parse(doc.watchlist) : [];
                    const loadedWatching = doc.watching ? JSON.parse(doc.watching) : [];
                    const loadedWatched = doc.watched ? JSON.parse(doc.watched) : [];
                    
                    console.log('Loaded data - Watchlist:', loadedWatchlist.length, 'Watching:', loadedWatching.length, 'Watched:', loadedWatched.length);
                    
                    setWatchlist(loadedWatchlist);
                    setWatching(loadedWatching);
                    setWatched(loadedWatched);
                    
                    // Also update localStorage
                    localStorage.setItem('watchlist', JSON.stringify(loadedWatchlist));
                    localStorage.setItem('watching', JSON.stringify(loadedWatching));
                    localStorage.setItem('watched', JSON.stringify(loadedWatched));
                    
                    setSaveStatus('Loaded from cloud ‚òÅÔ∏è');
                    setTimeout(() => setSaveStatus(''), 3000);
                } catch (error) {
                    console.error('Error loading from Appwrite:', error);
                    console.log('Error details:', error.message, error.code);
                    
                    if (error.code === 404) {
                        console.log('Document not found, will create on first save');
                    } else if (error.code === 401) {
                        console.error('Unauthorized - Please check Appwrite permissions');
                        setSaveStatus('Permission error ‚ùå');
                    } else {
                        console.error('Appwrite error:', error);
                    }
                    
                    // Set the doc ID even if document doesn't exist yet
                    setAppwriteDocId(USER_DOC_ID);
                    
                    // Load from localStorage as fallback
                    const savedWatchlist = localStorage.getItem('watchlist');
                    const savedWatching = localStorage.getItem('watching');
                    const savedWatched = localStorage.getItem('watched');
                    if (savedWatchlist) setWatchlist(JSON.parse(savedWatchlist));
                    if (savedWatching) setWatching(JSON.parse(savedWatching));
                    if (savedWatched) setWatched(JSON.parse(savedWatched));
                }
            };

            const saveDataToAppwrite = async (newWatchlist, newWatching, newWatched) => {
                if (APPWRITE_ENDPOINT === 'YOUR_APPWRITE_ENDPOINT') {
                    console.log('Appwrite not configured, skipping cloud save');
                    return;
                }

                try {
                    const data = {
                        watchlist: JSON.stringify(newWatchlist),
                        watching: JSON.stringify(newWatching),
                        watched: JSON.stringify(newWatched),
                        updatedAt: new Date().toISOString()
                    };

                    console.log('Saving to Appwrite - Watchlist:', newWatchlist.length, 'Watching:', newWatching.length, 'Watched:', newWatched.length);

                    try {
                        // Try to update existing document first
                        await databases.updateDocument(
                            APPWRITE_DATABASE_ID,
                            APPWRITE_COLLECTION_ID,
                            USER_DOC_ID,
                            data
                        );
                        console.log('Document updated successfully in Appwrite');
                        setSaveStatus('Saved to cloud ‚òÅÔ∏è');
                    } catch (updateError) {
                        console.log('Update failed, attempting to create document:', updateError.message);
                        // If document doesn't exist, create it
                        await databases.createDocument(
                            APPWRITE_DATABASE_ID,
                            APPWRITE_COLLECTION_ID,
                            USER_DOC_ID,
                            data
                        );
                        console.log('Document created successfully in Appwrite');
                        setSaveStatus('Saved to cloud ‚òÅÔ∏è');
                    }
                    
                    setTimeout(() => setSaveStatus(''), 3000);
                } catch (error) {
                    console.error('Error saving to Appwrite:', error);
                    console.error('Error details:', error.message, error.code, error.response);
                    
                    if (error.code === 401) {
                        setSaveStatus('Permission denied ‚ùå Check Appwrite settings');
                    } else if (error.code === 404) {
                        setSaveStatus('Collection not found ‚ùå');
                    } else {
                        setSaveStatus('Save failed ‚ùå ' + error.message);
                    }
                    setTimeout(() => setSaveStatus(''), 5000);
                }
            };

            // Save to localStorage and Appwrite whenever lists change
            // Use a single effect with a debounce to prevent multiple rapid saves
            useEffect(() => {
                if (!isAuthenticated || !appwriteDocId) return;
                
                // Save to localStorage immediately
                localStorage.setItem('watchlist', JSON.stringify(watchlist));
                localStorage.setItem('watching', JSON.stringify(watching));
                localStorage.setItem('watched', JSON.stringify(watched));
                
                // Debounce the Appwrite save to avoid too many API calls
                const timeoutId = setTimeout(() => {
                    saveDataToAppwrite(watchlist, watching, watched);
                }, 500);
                
                return () => clearTimeout(timeoutId);
            }, [watchlist, watching, watched, isAuthenticated, appwriteDocId]);

            const fetchTMDBContent = async (endpoint, params = {}) => {
                const queryParams = new URLSearchParams({
                    api_key: TMDB_API_KEY,
                    language: 'en-US',
                    ...params
                });
                const response = await fetch(`${TMDB_BASE_URL}${endpoint}?${queryParams}`);
                return response.json();
            };

            const fetchAnime = async (type = 'upcoming') => {
                let endpoint = '/seasons/now';
                if (type === 'upcoming') endpoint = '/seasons/upcoming';
                if (type === 'top') endpoint = '/top/anime';
                
                const response = await fetch(`${JIKAN_BASE_URL}${endpoint}`);
                const data = await response.json();
                return data.data;
            };

            const loadContent = async (page = 1) => {
                setLoading(true);
                try {
                    let allData = [];
                    const seenIds = new Set(); // Track unique IDs to avoid duplicates
                    
                    const mediaTypesToFetch = mediaType === 'all' 
                        ? ['movie', 'tv', 'anime'] 
                        : [mediaType];

                    for (const type of mediaTypesToFetch) {
                        if (type === 'anime') {
                            const animeData = await fetchAnime('now');
                            const formattedAnime = animeData.map(anime => ({
                                id: `anime-${anime.mal_id}`,
                                title: anime.title,
                                poster: anime.images.jpg.large_image_url,
                                overview: anime.synopsis,
                                rating: anime.score,
                                releaseDate: anime.aired?.from,
                                type: 'anime',
                                genres: anime.genres?.map(g => g.name) || [],
                                genreIds: anime.genres?.map(g => g.mal_id) || [],
                                studios: anime.studios?.map(s => s.name) || []
                            }));
                            
                            // Add only unique anime
                            formattedAnime.forEach(item => {
                                if (!seenIds.has(item.id)) {
                                    seenIds.add(item.id);
                                    allData.push(item);
                                }
                            });
                        } else {
                            const endpoint = type === 'movie' ? '/movie/popular' : '/tv/popular';
                            const tmdbData = await fetchTMDBContent(endpoint, { page: page });
                            const formattedData = tmdbData.results?.map(item => ({
                                id: `${type}-${item.id}`,
                                tmdbId: item.id,
                                title: item.title || item.name,
                                poster: item.poster_path ? TMDB_IMAGE_BASE + item.poster_path : null,
                                overview: item.overview,
                                rating: item.vote_average,
                                releaseDate: item.release_date || item.first_air_date,
                                type: type,
                                genreIds: item.genre_ids || [],
                                genres: item.genre_ids?.map(gid => GENRE_MAP[gid]).filter(Boolean) || []
                            })) || [];
                            
                            // Add only unique items
                            formattedData.forEach(item => {
                                if (!seenIds.has(item.id)) {
                                    seenIds.add(item.id);
                                    allData.push(item);
                                }
                            });
                        }
                    }
                    
                    setAllContent(allData);
                    applyFiltersAndPagination(allData, 1);
                    setTotalPages(Math.ceil(allData.length / ITEMS_PER_PAGE));
                } catch (error) {
                    console.error('Error fetching content:', error);
                    alert('Error loading content. Please check your internet connection.');
                }
                setLoading(false);
            };

            const applyFiltersAndPagination = (data, page) => {
                let filteredData = [...data];
                
                // Apply genre filter
                if (genre !== 'all') {
                    filteredData = filteredData.filter(item => 
                        item.genres?.includes(genre) || 
                        item.genreIds?.includes(parseInt(genre))
                    );
                }
                
                const startIndex = (page - 1) * ITEMS_PER_PAGE;
                const endIndex = startIndex + ITEMS_PER_PAGE;
                setContent(filteredData.slice(startIndex, endIndex));
                setCurrentPage(page);
                setTotalPages(Math.ceil(filteredData.length / ITEMS_PER_PAGE));
            };

            useEffect(() => {
                if (allContent.length > 0) {
                    applyFiltersAndPagination(allContent, 1);
                }
            }, [genre]);

            const performDynamicSearch = async (query) => {
                if (!query.trim() || query.length < 2) {
                    setSearchSuggestions([]);
                    setShowSuggestions(false);
                    return;
                }

                try {
                    let suggestions = [];
                    
                    const typesToSearch = mediaType === 'all' ? ['movie', 'tv', 'anime'] : [mediaType];
                    
                    for (const type of typesToSearch) {
                        if (type === 'anime') {
                            const response = await fetch(`${JIKAN_BASE_URL}/anime?q=${query}&limit=5`);
                            const animeData = await response.json();
                            const animeSuggestions = animeData.data.map(anime => ({
                                id: `anime-${anime.mal_id}`,
                                title: anime.title,
                                poster: anime.images.jpg.image_url,
                                year: anime.year,
                                type: 'anime'
                            }));
                            suggestions = [...suggestions, ...animeSuggestions];
                        } else {
                            const endpoint = `/search/${type}`;
                            const tmdbData = await fetchTMDBContent(endpoint, { query, page: 1 });
                            const tmdbSuggestions = tmdbData.results?.slice(0, 5).map(item => ({
                                id: `${type}-${item.id}`,
                                title: item.title || item.name,
                                poster: item.poster_path ? TMDB_IMAGE_BASE + item.poster_path : null,
                                year: (item.release_date || item.first_air_date)?.split('-')[0],
                                type: type
                            })) || [];
                            suggestions = [...suggestions, ...tmdbSuggestions];
                        }
                    }
                    
                    setSearchSuggestions(suggestions.slice(0, 15));
                    setShowSuggestions(true);
                } catch (error) {
                    console.error('Error searching:', error);
                }
            };

            const handleSearchInput = (value) => {
                setSearchQuery(value);
                
                if (searchTimeout.current) {
                    clearTimeout(searchTimeout.current);
                }

                searchTimeout.current = setTimeout(() => {
                    performDynamicSearch(value);
                }, 300);
            };

            const selectSuggestion = async (suggestion) => {
                setSearchQuery(suggestion.title);
                setShowSuggestions(false);
                await searchContent(suggestion.title);
            };

            const searchContent = async (query = searchQuery) => {
                if (!query.trim()) {
                    loadContent();
                    return;
                }
                setLoading(true);
                try {
                    let allData = [];
                    
                    const typesToSearch = mediaType === 'all' ? ['movie', 'tv', 'anime'] : [mediaType];
                    
                    for (const type of typesToSearch) {
                        if (type === 'anime') {
                            const response = await fetch(`${JIKAN_BASE_URL}/anime?q=${query}&limit=10`);
                            const animeData = await response.json();
                            const formattedAnime = animeData.data.map(anime => ({
                                id: `anime-${anime.mal_id}`,
                                title: anime.title,
                                poster: anime.images.jpg.large_image_url,
                                overview: anime.synopsis,
                                rating: anime.score,
                                releaseDate: anime.aired?.from,
                                type: 'anime',
                                regionLabel: 'Japan'
                            }));
                            allData = [...allData, ...formattedAnime];
                        } else {
                            const endpoint = `/search/${type}`;
                            const tmdbData = await fetchTMDBContent(endpoint, { query });
                            const formattedData = tmdbData.results?.slice(0, 10).map(item => ({
                                id: `${type}-${item.id}`,
                                title: item.title || item.name,
                                poster: item.poster_path ? TMDB_IMAGE_BASE + item.poster_path : null,
                                overview: item.overview,
                                rating: item.vote_average,
                                releaseDate: item.release_date || item.first_air_date,
                                type: type
                            })) || [];
                            allData = [...allData, ...formattedData];
                        }
                    }
                    
                    setContent(allData);
                    setShowSuggestions(false);
                } catch (error) {
                    console.error('Error searching:', error);
                }
                setLoading(false);
            };

            useEffect(() => {
                if (activeTab === 'discover' && isAuthenticated) {
                    loadContent();
                }
            }, [mediaType, activeTab, isAuthenticated]);

            const addToWatchlist = (item) => {
                if (!watchlist.find(w => w.id === item.id)) {
                    setWatchlist([...watchlist, { ...item, addedDate: new Date().toISOString() }]);
                }
            };

            const addToWatching = (item) => {
                if (!watching.find(w => w.id === item.id)) {
                    setWatching([...watching, { ...item, startedDate: new Date().toISOString() }]);
                }
                setWatchlist(watchlist.filter(w => w.id !== item.id));
            };

            const markAsWatched = (item) => {
                if (!watched.find(w => w.id === item.id)) {
                    setWatched([...watched, { ...item, watchedDate: new Date().toISOString() }]);
                }
                setWatchlist(watchlist.filter(w => w.id !== item.id));
                setWatching(watching.filter(w => w.id !== item.id));
            };

            const removeFromWatchlist = (id) => {
                setWatchlist(watchlist.filter(item => item.id !== id));
            };

            const removeFromWatching = (id) => {
                setWatching(watching.filter(item => item.id !== id));
            };

            const removeFromWatched = (id) => {
                setWatched(watched.filter(item => item.id !== id));
            };
            
            const fetchItemDetails = async (item) => {
                setSelectedItem(item);
                setShowModal(true);
                setModalDetails(null);
                
                try {
                    if (item.type === 'anime') {
                        const animeId = item.id.replace('anime-', '');
                        const response = await fetch(`${JIKAN_BASE_URL}/anime/${animeId}/full`);
                        const data = await response.json();
                        const anime = data.data;
                        
                        setModalDetails({
                            title: anime.title,
                            poster: anime.images.jpg.large_image_url,
                            overview: anime.synopsis,
                            rating: anime.score,
                            year: anime.year,
                            episodes: anime.episodes,
                            status: anime.status,
                            genres: anime.genres?.map(g => g.name).join(', '),
                            studios: anime.studios?.map(s => s.name).join(', '),
                            duration: anime.duration,
                            type: 'Anime',
                            streaming: anime.streaming?.map(s => ({ name: s.name, url: s.url })) || []
                        });
                    } else {
                        const tmdbId = item.tmdbId || item.id.split('-')[1];
                        const endpoint = item.type === 'movie' ? `/movie/${tmdbId}` : `/tv/${tmdbId}`;
                        const detailsData = await fetchTMDBContent(endpoint, { append_to_response: 'watch/providers' });
                        
                        const providers = detailsData['watch/providers']?.results?.US || {};
                        const streaming = [
                            ...(providers.flatrate || []),
                            ...(providers.buy || []),
                            ...(providers.rent || [])
                        ].filter((v, i, a) => a.findIndex(t => t.provider_id === v.provider_id) === i);
                        
                        setModalDetails({
                            title: detailsData.title || detailsData.name,
                            poster: detailsData.poster_path ? TMDB_IMAGE_BASE + detailsData.poster_path : null,
                            backdrop: detailsData.backdrop_path ? `https://image.tmdb.org/t/p/w1280${detailsData.backdrop_path}` : null,
                            overview: detailsData.overview,
                            rating: detailsData.vote_average,
                            year: (detailsData.release_date || detailsData.first_air_date)?.split('-')[0],
                            runtime: detailsData.runtime || detailsData.episode_run_time?.[0],
                            status: detailsData.status,
                            genres: detailsData.genres?.map(g => g.name).join(', '),
                            seasons: detailsData.number_of_seasons,
                            episodes: detailsData.number_of_episodes,
                            type: item.type === 'movie' ? 'Movie' : 'TV Series',
                            streaming: streaming.map(s => ({ name: s.provider_name, logo: `https://image.tmdb.org/t/p/w92${s.logo_path}` }))
                        });
                    }
                } catch (error) {
                    console.error('Error fetching details:', error);
                    setModalDetails({ error: 'Failed to load details' });
                }
            };

            const MediaCard = ({ item, showActions = true }) => (
                <div className="bg-white rounded-lg shadow-lg overflow-hidden card-hover transition-all duration-300">
                    <div className="relative h-64 sm:h-72 md:h-80 cursor-pointer" onClick={() => fetchItemDetails(item)}>
                        {item.poster ? (
                            <img src={item.poster} alt={item.title} className="w-full h-full object-cover" />
                        ) : (
                            <div className="w-full h-full bg-gray-300 flex items-center justify-center">
                                <span className="text-gray-500 text-3xl sm:text-4xl">üé¨</span>
                            </div>
                        )}
                        {item.rating && (
                            <div className="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full font-bold text-xs sm:text-sm">
                                ‚≠ê {item.rating?.toFixed(1)}
                            </div>
                        )}
                        <div className="absolute top-2 left-2 flex gap-1 flex-col">
                            <div className="bg-purple-600 text-white px-2 py-1 rounded text-xs font-bold uppercase">
                                {item.type}
                            </div>
                        </div>
                        {item.genres && item.genres.length > 0 && (
                            <div className="absolute bottom-2 left-2 right-2 flex gap-1 flex-wrap">
                                {item.genres.slice(0, 2).map((genre, idx) => (
                                    <span key={idx} className="bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs">
                                        {genre}
                                    </span>
                                ))}
                            </div>
                        )}
                    </div>
                    <div className="p-3 sm:p-4">
                        <h3 className="font-bold text-base sm:text-lg mb-1 sm:mb-2 text-gray-800 truncate cursor-pointer hover:text-purple-600" title={item.title} onClick={() => fetchItemDetails(item)}>{item.title}</h3>
                        <p className="text-gray-600 text-xs sm:text-sm mb-2">
                            {item.releaseDate ? new Date(item.releaseDate).toLocaleDateString() : 'TBA'}
                        </p>
                        <p className="text-gray-700 text-xs sm:text-sm line-clamp-2 sm:line-clamp-3 mb-3 sm:mb-4">{item.overview || 'No description available'}</p>
                        {showActions && (
                            <div className="flex gap-1 sm:gap-2 flex-wrap">
                                {activeTab === 'discover' && (
                                    <>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); addToWatchlist(item); }}
                                            className="flex-1 min-w-[80px] bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-2 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            + List
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); addToWatching(item); }}
                                            className="flex-1 min-w-[80px] bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white px-2 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            üëÅ Now
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); markAsWatched(item); }}
                                            className="flex-1 min-w-[80px] bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-2 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            ‚úì Done
                                        </button>
                                    </>
                                )}
                                {activeTab === 'watchlist' && (
                                    <>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); addToWatching(item); }}
                                            className="flex-1 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            üëÅ Watch
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); markAsWatched(item); }}
                                            className="flex-1 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            ‚úì Done
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); removeFromWatchlist(item.id); }}
                                            className="flex-1 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            Remove
                                        </button>
                                    </>
                                )}
                                {activeTab === 'watching' && (
                                    <>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); markAsWatched(item); }}
                                            className="flex-1 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            ‚úì Finished
                                        </button>
                                        <button
                                            onClick={(e) => { e.stopPropagation(); removeFromWatching(item.id); }}
                                            className="flex-1 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                        >
                                            Remove
                                        </button>
                                    </>
                                )}
                                {activeTab === 'watched' && (
                                    <button
                                        onClick={(e) => { e.stopPropagation(); removeFromWatched(item.id); }}
                                        className="w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm font-semibold transition"
                                    >
                                        Remove
                                    </button>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );

            if (!isAuthenticated) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="min-h-screen p-2 sm:p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-2xl p-4 sm:p-6 mb-4 sm:mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h1 className="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-1 sm:mb-2">üé¨ Media Tracker</h1>
                                <p className="text-sm sm:text-base text-gray-600">Track movies, anime, and web series</p>
                                {saveStatus && (
                                    <p className="text-xs sm:text-sm text-green-600 mt-1">{saveStatus}</p>
                                )}
                            </div>
                            <button
                                onClick={handleLogout}
                                className="w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition text-sm sm:text-base"
                            >
                                Logout
                            </button>
                        </div>

                        {/* Navigation Tabs */}
                        <div className="bg-white rounded-2xl shadow-2xl p-2 mb-4 sm:mb-8">
                            <div className="grid grid-cols-2 sm:flex gap-2">
                                <button
                                    onClick={() => setActiveTab('discover')}
                                    className={`flex-1 min-w-[100px] px-2 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold transition text-xs sm:text-sm md:text-base ${
                                        activeTab === 'discover' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <span className="hidden sm:inline">üîç </span>Discover
                                </button>
                                <button
                                    onClick={() => setActiveTab('watchlist')}
                                    className={`flex-1 min-w-[100px] px-2 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold transition text-xs sm:text-sm md:text-base ${
                                        activeTab === 'watchlist' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <span className="hidden sm:inline">üìã </span>List<span className="hidden sm:inline"> ({watchlist.length})</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('watching')}
                                    className={`flex-1 min-w-[100px] px-2 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold transition text-xs sm:text-sm md:text-base ${
                                        activeTab === 'watching' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <span className="hidden sm:inline">üëÅ </span>Now<span className="hidden sm:inline"> ({watching.length})</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('watched')}
                                    className={`flex-1 min-w-[100px] px-2 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold transition text-xs sm:text-sm md:text-base ${
                                        activeTab === 'watched' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <span className="hidden sm:inline">‚úì </span>Done<span className="hidden sm:inline"> ({watched.length})</span>
                                </button>
                            </div>
                        </div>

                        {/* Filters and Search */}
                        {activeTab === 'discover' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-4 sm:p-6 mb-4 sm:mb-8">
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-4">
                                    <div>
                                        <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">Media Type</label>
                                        <select
                                            value={mediaType}
                                            onChange={(e) => setMediaType(e.target.value)}
                                            className="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                        >
                                            <option value="all">All Media</option>
                                            <option value="movie">Movies</option>
                                            <option value="tv">TV Series</option>
                                            <option value="anime">Anime</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">Genre</label>
                                        <select
                                            value={genre}
                                            onChange={(e) => setGenre(e.target.value)}
                                            className="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                        >
                                            <option value="all">All Genres</option>
                                            <option value="Action">Action</option>
                                            <option value="Adventure">Adventure</option>
                                            <option value="Animation">Animation</option>
                                            <option value="Comedy">Comedy</option>
                                            <option value="Crime">Crime</option>
                                            <option value="Documentary">Documentary</option>
                                            <option value="Drama">Drama</option>
                                            <option value="Family">Family</option>
                                            <option value="Fantasy">Fantasy</option>
                                            <option value="History">History</option>
                                            <option value="Horror">Horror</option>
                                            <option value="Music">Music</option>
                                            <option value="Mystery">Mystery</option>
                                            <option value="Romance">Romance</option>
                                            <option value="Sci-Fi">Sci-Fi</option>
                                            <option value="Thriller">Thriller</option>
                                            <option value="War">War</option>
                                            <option value="Western">Western</option>
                                        </select>
                                    </div>
                                    <div className="sm:col-span-2 lg:col-span-1">
                                        <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">Search</label>
                                        <div className="relative">
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => handleSearchInput(e.target.value)}
                                                    onKeyPress={(e) => e.key === 'Enter' && searchContent()}
                                                    onFocus={() => searchQuery.length >= 2 && setShowSuggestions(true)}
                                                    placeholder="Search..."
                                                    className="flex-1 px-3 sm:px-4 py-2 text-sm sm:text-base border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                                />
                                                <button
                                                    onClick={() => searchContent()}
                                                    className="bg-purple-600 hover:bg-purple-700 text-white px-3 sm:px-6 py-2 rounded-lg font-semibold transition text-sm sm:text-base whitespace-nowrap"
                                                >
                                                    Search
                                                </button>
                                                {searchQuery && (
                                                    <button
                                                        onClick={() => {
                                                            setSearchQuery('');
                                                            setShowSuggestions(false);
                                                            setSearchSuggestions([]);
                                                            loadContent();
                                                        }}
                                                        className="bg-gray-500 hover:bg-gray-600 text-white px-2 sm:px-4 py-2 rounded-lg font-semibold transition text-sm sm:text-base"
                                                    >
                                                        ‚úï
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {/* Dynamic Search Suggestions Dropdown */}
                                            {showSuggestions && searchSuggestions.length > 0 && (
                                                <div className="absolute z-50 w-full mt-2 bg-white border-2 border-purple-300 rounded-lg shadow-2xl max-h-60 sm:max-h-96 overflow-y-auto mobile-search-dropdown">
                                                    {searchSuggestions.map((suggestion) => (
                                                        <div
                                                            key={suggestion.id}
                                                            onClick={() => selectSuggestion(suggestion)}
                                                            className="flex items-center gap-2 sm:gap-3 p-2 sm:p-3 hover:bg-purple-50 active:bg-purple-100 cursor-pointer border-b border-gray-200 transition"
                                                        >
                                                            {suggestion.poster ? (
                                                                <img 
                                                                    src={suggestion.poster} 
                                                                    alt={suggestion.title}
                                                                    className="w-10 h-14 sm:w-12 sm:h-16 object-cover rounded flex-shrink-0"
                                                                />
                                                            ) : (
                                                                <div className="w-10 h-14 sm:w-12 sm:h-16 bg-gray-300 rounded flex items-center justify-center text-xl sm:text-2xl flex-shrink-0">
                                                                    üé¨
                                                                </div>
                                                            )}
                                                            <div className="flex-1 min-w-0">
                                                                <div className="font-semibold text-gray-800 text-sm sm:text-base truncate">{suggestion.title}</div>
                                                                <div className="text-xs sm:text-sm text-gray-600">
                                                                    {suggestion.year && `${suggestion.year} ‚Ä¢ `}
                                                                    <span className="capitalize">{suggestion.type}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Content Grid */}
                        <div className="bg-white rounded-2xl shadow-2xl p-3 sm:p-6">
                            {loading ? (
                                <div className="flex justify-center items-center h-64">
                                    <div className="text-xl sm:text-2xl text-gray-600">Loading...</div>
                                </div>
                            ) : (
                                <>
                                    {activeTab === 'discover' && (
                                        <>
                                            <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-6">
                                                {content.map(item => (
                                                    <MediaCard key={item.id} item={item} />
                                                ))}
                                            </div>
                                            
                                            {/* Pagination Controls */}
                                            {totalPages > 1 && (
                                                <div className="mt-6 sm:mt-8 flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4">
                                                    <button
                                                        onClick={() => applyFiltersAndPagination(allContent, currentPage - 1)}
                                                        disabled={currentPage === 1}
                                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-semibold transition text-sm sm:text-base ${
                                                            currentPage === 1 
                                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                                                : 'bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white'
                                                        }`}
                                                    >
                                                        ‚Üê Previous
                                                    </button>
                                                    
                                                    <div className="flex gap-1 sm:gap-2 flex-wrap justify-center">
                                                        {[...Array(Math.min(5, totalPages))].map((_, idx) => {
                                                            let pageNum;
                                                            if (totalPages <= 5) {
                                                                pageNum = idx + 1;
                                                            } else if (currentPage <= 3) {
                                                                pageNum = idx + 1;
                                                            } else if (currentPage >= totalPages - 2) {
                                                                pageNum = totalPages - 4 + idx;
                                                            } else {
                                                                pageNum = currentPage - 2 + idx;
                                                            }
                                                            
                                                            return (
                                                                <button
                                                                    key={pageNum}
                                                                    onClick={() => applyFiltersAndPagination(allContent, pageNum)}
                                                                    className={`px-3 sm:px-4 py-2 rounded-lg font-semibold transition text-sm sm:text-base min-w-[40px] sm:min-w-[48px] ${
                                                                        currentPage === pageNum 
                                                                            ? 'bg-purple-600 text-white' 
                                                                            : 'bg-gray-200 hover:bg-gray-300 active:bg-gray-400 text-gray-700'
                                                                    }`}
                                                                >
                                                                    {pageNum}
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                    
                                                    <button
                                                        onClick={() => applyFiltersAndPagination(allContent, currentPage + 1)}
                                                        disabled={currentPage === totalPages}
                                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-semibold transition text-sm sm:text-base ${
                                                            currentPage === totalPages 
                                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                                                : 'bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white'
                                                        }`}
                                                    >
                                                        Next ‚Üí
                                                    </button>
                                                </div>
                                            )}
                                        </>
                                    )}
                                    {activeTab === 'watchlist' && (
                                        watchlist.length > 0 ? (
                                            <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-6">
                                                {watchlist.map(item => (
                                                    <MediaCard key={item.id} item={item} />
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-12 sm:py-16 text-gray-500">
                                                <p className="text-4xl sm:text-5xl mb-2">üìã</p>
                                                <p className="text-lg sm:text-xl font-semibold">Your watchlist is empty</p>
                                                <p className="text-sm sm:text-base mt-2">Start adding content from the Discover tab!</p>
                                            </div>
                                        )
                                    )}
                                    {activeTab === 'watching' && (
                                        watching.length > 0 ? (
                                            <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-6">
                                                {watching.map(item => (
                                                    <MediaCard key={item.id} item={item} />
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-12 sm:py-16 text-gray-500">
                                                <p className="text-4xl sm:text-5xl mb-2">üëÅ</p>
                                                <p className="text-lg sm:text-xl font-semibold">Not currently watching anything</p>
                                                <p className="text-sm sm:text-base mt-2">Mark content as watching to track your progress!</p>
                                            </div>
                                        )
                                    )}
                                    {activeTab === 'watched' && (
                                        watched.length > 0 ? (
                                            <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-6">
                                                {watched.map(item => (
                                                    <MediaCard key={item.id} item={item} />
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-12 sm:py-16 text-gray-500">
                                                <p className="text-4xl sm:text-5xl mb-2">‚úì</p>
                                                <p className="text-lg sm:text-xl font-semibold">No watched content yet</p>
                                                <p className="text-sm sm:text-base mt-2">Mark content as watched to track your progress!</p>
                                            </div>
                                        )
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                    
                    {/* Details Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50" onClick={() => setShowModal(false)}>
                            <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                {modalDetails ? (
                                    modalDetails.error ? (
                                        <div className="p-8 text-center">
                                            <p className="text-red-600 text-xl">{modalDetails.error}</p>
                                        </div>
                                    ) : (
                                        <>
                                            {modalDetails.backdrop && (
                                                <div className="relative h-64 sm:h-96">
                                                    <img src={modalDetails.backdrop} alt={modalDetails.title} className="w-full h-full object-cover rounded-t-2xl" />
                                                    <div className="absolute inset-0 bg-gradient-to-t from-black to-transparent rounded-t-2xl"></div>
                                                    <button 
                                                        onClick={() => setShowModal(false)}
                                                        className="absolute top-4 right-4 bg-black bg-opacity-50 hover:bg-opacity-75 text-white rounded-full w-10 h-10 flex items-center justify-center text-2xl"
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                            )}
                                            <div className="p-6 sm:p-8">
                                                {!modalDetails.backdrop && (
                                                    <button 
                                                        onClick={() => setShowModal(false)}
                                                        className="float-right bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full w-10 h-10 flex items-center justify-center text-2xl"
                                                    >
                                                        √ó
                                                    </button>
                                                )}
                                                <div className="flex flex-col sm:flex-row gap-6">
                                                    {modalDetails.poster && (
                                                        <img src={modalDetails.poster} alt={modalDetails.title} className="w-full sm:w-64 rounded-lg shadow-lg" />
                                                    )}
                                                    <div className="flex-1">
                                                        <h2 className="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">{modalDetails.title}</h2>
                                                        <div className="flex flex-wrap gap-2 mb-4">
                                                            {modalDetails.rating && (
                                                                <span className="bg-yellow-500 text-white px-3 py-1 rounded-full font-bold">
                                                                    ‚≠ê {modalDetails.rating?.toFixed(1)}
                                                                </span>
                                                            )}
                                                            <span className="bg-purple-600 text-white px-3 py-1 rounded-full font-bold">
                                                                {modalDetails.type}
                                                            </span>
                                                            {modalDetails.year && (
                                                                <span className="bg-gray-600 text-white px-3 py-1 rounded-full font-bold">
                                                                    {modalDetails.year}
                                                                </span>
                                                            )}
                                                            {modalDetails.status && (
                                                                <span className="bg-blue-600 text-white px-3 py-1 rounded-full font-bold text-sm">
                                                                    {modalDetails.status}
                                                                </span>
                                                            )}
                                                        </div>
                                                        
                                                        {modalDetails.genres && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Genres:</strong> {modalDetails.genres}
                                                            </p>
                                                        )}
                                                        
                                                        {modalDetails.runtime && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Runtime:</strong> {modalDetails.runtime} min
                                                            </p>
                                                        )}
                                                        
                                                        {modalDetails.seasons && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Seasons:</strong> {modalDetails.seasons} ({modalDetails.episodes} episodes)
                                                            </p>
                                                        )}
                                                        
                                                        {modalDetails.episodes && !modalDetails.seasons && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Episodes:</strong> {modalDetails.episodes}
                                                            </p>
                                                        )}
                                                        
                                                        {modalDetails.studios && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Studios:</strong> {modalDetails.studios}
                                                            </p>
                                                        )}
                                                        
                                                        {modalDetails.duration && (
                                                            <p className="text-gray-700 mb-3">
                                                                <strong>Duration:</strong> {modalDetails.duration}
                                                            </p>
                                                        )}
                                                        
                                                        <p className="text-gray-700 mb-6 leading-relaxed">
                                                            {modalDetails.overview || 'No description available.'}
                                                        </p>
                                                        
                                                        {modalDetails.streaming && modalDetails.streaming.length > 0 && (
                                                            <div className="border-t pt-4">
                                                                <h3 className="text-xl font-bold text-gray-800 mb-3">Where to Watch</h3>
                                                                <div className="flex flex-wrap gap-3">
                                                                    {modalDetails.streaming.map((provider, idx) => (
                                                                        <div key={idx} className="flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-lg">
                                                                            {provider.logo && (
                                                                                <img src={provider.logo} alt={provider.name} className="w-8 h-8 rounded" />
                                                                            )}
                                                                            <span className="font-semibold text-sm">{provider.name}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        <div className="mt-6 flex gap-2 flex-wrap">
                                                            <button
                                                                onClick={() => { addToWatchlist(selectedItem); setShowModal(false); }}
                                                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition"
                                                            >
                                                                + Add to Watchlist
                                                            </button>
                                                            <button
                                                                onClick={() => { addToWatching(selectedItem); setShowModal(false); }}
                                                                className="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-semibold transition"
                                                            >
                                                                üëÅ Watching Now
                                                            </button>
                                                            <button
                                                                onClick={() => { markAsWatched(selectedItem); setShowModal(false); }}
                                                                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition"
                                                            >
                                                                ‚úì Mark as Watched
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    )
                                ) : (
                                    <div className="p-8 text-center">
                                        <div className="text-4xl mb-4">‚è≥</div>
                                        <p className="text-xl text-gray-600">Loading details...</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<MediaTracker />, document.getElementById('root'));
    </script>
</body>
</html>
